"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4674],{3905:(e,n,r)=>{r.d(n,{Zo:()=>p,kt:()=>g});var t=r(67294);function o(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function s(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function a(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?s(Object(r),!0).forEach((function(n){o(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function i(e,n){if(null==e)return{};var r,t,o=function(e,n){if(null==e)return{};var r,t,o={},s=Object.keys(e);for(t=0;t<s.length;t++)r=s[t],n.indexOf(r)>=0||(o[r]=e[r]);return o}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(t=0;t<s.length;t++)r=s[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var c=t.createContext({}),l=function(e){var n=t.useContext(c),r=n;return e&&(r="function"==typeof e?e(n):a(a({},n),e)),r},p=function(e){var n=l(e.components);return t.createElement(c.Provider,{value:n},e.children)},u="mdxType",f={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef((function(e,n){var r=e.components,o=e.mdxType,s=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=l(r),m=o,g=u["".concat(c,".").concat(m)]||u[m]||f[m]||s;return r?t.createElement(g,a(a({ref:n},p),{},{components:r})):t.createElement(g,a({ref:n},p))}));function g(e,n){var r=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var s=r.length,a=new Array(s);a[0]=m;var i={};for(var c in n)hasOwnProperty.call(n,c)&&(i[c]=n[c]);i.originalType=e,i[u]="string"==typeof e?e:o,a[1]=i;for(var l=2;l<s;l++)a[l]=r[l];return t.createElement.apply(null,a)}return t.createElement.apply(null,r)}m.displayName="MDXCreateElement"},93583:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var t=r(87462),o=(r(67294),r(3905));const s={},a=void 0,i={unversionedId:"intro/npm/axios",id:"intro/npm/axios",title:"axios",description:"\u5c01\u88c5\u901a\u7528\u5b9e\u4f8b",source:"@site/docs/intro/npm/axios.md",sourceDirName:"intro/npm",slug:"/intro/npm/axios",permalink:"/docs/intro/npm/axios",draft:!1,editUrl:"https://github.com/foolishandi/myblog/tree/main/docs/intro/npm/axios.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"css-in-js",permalink:"/docs/intro/npm/css-in-js"},next:{title:"momentjs",permalink:"/docs/intro/npm/momentjs"}},c={},l=[{value:"\u5c01\u88c5\u901a\u7528\u5b9e\u4f8b",id:"\u5c01\u88c5\u901a\u7528\u5b9e\u4f8b",level:2},{value:"\u9650\u5236\u8d85\u65f6\u4e0e\u8d85\u65f6\u91cd\u8fde",id:"\u9650\u5236\u8d85\u65f6\u4e0e\u8d85\u65f6\u91cd\u8fde",level:2},{value:"\u7b80\u5355\u8d85\u65f6\u9650\u5236",id:"\u7b80\u5355\u8d85\u65f6\u9650\u5236",level:3},{value:"\u91cd\u8fde\u6b21\u6570\u9650\u5236",id:"\u91cd\u8fde\u6b21\u6570\u9650\u5236",level:3},{value:"\u4e2d\u9014\u53d6\u6d88\u8bf7\u6c42",id:"\u4e2d\u9014\u53d6\u6d88\u8bf7\u6c42",level:2}],p={toc:l};function u(e){let{components:n,...r}=e;return(0,o.kt)("wrapper",(0,t.Z)({},p,r,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"\u5c01\u88c5\u901a\u7528\u5b9e\u4f8b"},"\u5c01\u88c5\u901a\u7528\u5b9e\u4f8b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import axios from "axios";\nimport { message } from "antd";\nimport Cookies from "js-cookie";\n// console.log(process.env);\nconst service = axios.create({\n  baseURL:\n    process.env.NODE_ENV === "development" ? "http://localhost:8080/" : "/",\n  timeout: 10 * 1000,\n});\n// 2.\u8bf7\u6c42\u62e6\u622a\u5668\nservice.interceptors.request.use(\n  (config) => {\n    //\u53d1\u8bf7\u6c42\u524d\u505a\u7684\u4e00\u4e9b\u5904\u7406\uff0c\u6570\u636e\u8f6c\u5316\uff0c\u914d\u7f6e\u8bf7\u6c42\u5934\uff0c\u8bbe\u7f6etoken,\u8bbe\u7f6eloading\u7b49\uff0c\u6839\u636e\u9700\u6c42\u53bb\u6dfb\u52a0\n    config.data = JSON.stringify(config.data); //\u6570\u636e\u8f6c\u5316,\u4e5f\u53ef\u4ee5\u4f7f\u7528qs\u8f6c\u6362\n    //\u5982\u6709\u9700\u8981\uff1a\u6ce8\u610f\u4f7f\u7528token\u7684\u65f6\u5019\u9700\u8981\u5f15\u5165cookie\u65b9\u6cd5\u6216\u8005\u7528\u672c\u5730localStorage\u7b49\u65b9\u6cd5\uff0c\u63a8\u8350js-cookie\n    const token = Cookies.get("accessToken"); //\u8fd9\u91cc\u53d6token\u4e4b\u524d\uff0c\u4f60\u80af\u5b9a\u9700\u8981\u5148\u62ff\u5230token,\u5b58\u4e00\u4e0b\n    if (token) {\n      // config.params = { token: token }; //\u5982\u679c\u8981\u6c42\u643a\u5e26\u5728\u53c2\u6570\u4e2d\n      config.headers.Authorization = token; //\u5982\u679c\u8981\u6c42\u643a\u5e26\u5728\u8bf7\u6c42\u5934\u4e2d\n    }\n    return config;\n  },\n  (error) => {\n    Promise.reject(error);\n  }\n);\n\n// 3.\u54cd\u5e94\u62e6\u622a\u5668\nservice.interceptors.response.use(\n  (response) => {\n    //\u63a5\u6536\u5230\u54cd\u5e94\u6570\u636e\u5e76\u6210\u529f\u540e\u7684\u4e00\u4e9b\u5171\u6709\u7684\u5904\u7406\uff0c\u5173\u95edloading\u7b49\n\n    return response;\n  },\n  (error) => {\n    /***** \u63a5\u6536\u5230\u5f02\u5e38\u54cd\u5e94\u7684\u5904\u7406\u5f00\u59cb *****/\n    if (error && error.response) {\n      // 1.\u516c\u5171\u9519\u8bef\u5904\u7406\n      // 2.\u6839\u636e\u54cd\u5e94\u7801\u5177\u4f53\u5904\u7406\n      switch (error.response.status) {\n        case 400:\n          error.message = "\u9519\u8bef\u8bf7\u6c42";\n          break;\n        case 401:\n          error.message = "\u672a\u6388\u6743\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55";\n          break;\n        case 403:\n          error.message = "\u62d2\u7edd\u8bbf\u95ee";\n          break;\n        case 404:\n          error.message = "\u8bf7\u6c42\u9519\u8bef,\u672a\u627e\u5230\u8be5\u8d44\u6e90";\n          window.location.href = "/NotFound";\n          break;\n        case 405:\n          error.message = "\u8bf7\u6c42\u65b9\u6cd5\u672a\u5141\u8bb8";\n          break;\n        case 408:\n          error.message = "\u8bf7\u6c42\u8d85\u65f6";\n          break;\n        case 500:\n          error.message = "\u670d\u52a1\u5668\u7aef\u51fa\u9519";\n          break;\n        case 501:\n          error.message = "\u7f51\u7edc\u672a\u5b9e\u73b0";\n          break;\n        case 502:\n          error.message = "\u7f51\u7edc\u9519\u8bef";\n          break;\n        case 503:\n          error.message = "\u670d\u52a1\u4e0d\u53ef\u7528";\n          break;\n        case 504:\n          error.message = "\u7f51\u7edc\u8d85\u65f6";\n          break;\n        case 505:\n          error.message = "http\u7248\u672c\u4e0d\u652f\u6301\u8be5\u8bf7\u6c42";\n          break;\n        default:\n          error.message = `\u8fde\u63a5\u9519\u8bef${error.response.status}`;\n      }\n    } else {\n      // \u8d85\u65f6\u5904\u7406\n      if (JSON.stringify(error).includes("timeout")) {\n        message.error("\u670d\u52a1\u5668\u54cd\u5e94\u8d85\u65f6\uff0c\u8bf7\u5237\u65b0\u5f53\u524d\u9875");\n      }\n      error.message = "\u8fde\u63a5\u670d\u52a1\u5668\u5931\u8d25";\n    }\n\n    message.error(error.message);\n    /***** \u5904\u7406\u7ed3\u675f *****/\n    //\u5982\u679c\u4e0d\u9700\u8981\u9519\u8bef\u5904\u7406\uff0c\u4ee5\u4e0a\u7684\u5904\u7406\u8fc7\u7a0b\u90fd\u53ef\u7701\u7565\n    return Promise.resolve(error.response);\n  }\n);\n//4.\u5bfc\u51fa\u6587\u4ef6\nexport default service;\n')),(0,o.kt)("h2",{id:"\u9650\u5236\u8d85\u65f6\u4e0e\u8d85\u65f6\u91cd\u8fde"},"\u9650\u5236\u8d85\u65f6\u4e0e\u8d85\u65f6\u91cd\u8fde"),(0,o.kt)("h3",{id:"\u7b80\u5355\u8d85\u65f6\u9650\u5236"},"\u7b80\u5355\u8d85\u65f6\u9650\u5236"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import axios from "axios";\n\naxios.defaults.timeout = 10 * 1000; // 10s\n')),(0,o.kt)("h3",{id:"\u91cd\u8fde\u6b21\u6570\u9650\u5236"},"\u91cd\u8fde\u6b21\u6570\u9650\u5236"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:"title='ajaxUtil.js'",title:"'ajaxUtil.js'"},"//\u5728ajaxUtil.js\u8bbe\u7f6e\u5168\u5c40\u7684\u8bf7\u6c42\u6b21\u6570\uff0c\u8bf7\u6c42\u7684\u95f4\u9699\naxios.defaults.retry = 4;\naxios.defaults.retryDelay = 1000;\naxios.interceptors.response.use(undefined, function axiosRetryInterceptor(err) {\n  var config = err.config;\n  if (!config || !config.retry) return Promise.reject(err);\n  config.__retryCount = config.__retryCount || 0;\n  if (config.__retryCount >= config.retry) {\n    return Promise.reject(err);\n  }\n  config.__retryCount += 1;\n  var backoff = new Promise(function (resolve) {\n    setTimeout(function () {\n      resolve();\n    }, config.retryDelay || 1);\n  });\n  return backoff.then(function () {\n    return axios(config);\n  });\n});\n")),(0,o.kt)("h2",{id:"\u4e2d\u9014\u53d6\u6d88\u8bf7\u6c42"},"\u4e2d\u9014\u53d6\u6d88\u8bf7\u6c42"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"   import axios from 'axios';\n\n    axios.defaults.timeout = 5000;\n    axios.defaults.baseURL ='';\n\n    let pending = []; //\u58f0\u660e\u4e00\u4e2a\u6570\u7ec4\u7528\u4e8e\u5b58\u50a8\u6bcf\u4e2aajax\u8bf7\u6c42\u7684\u53d6\u6d88\u51fd\u6570\u548cajax\u6807\u8bc6\n    let cancelToken = axios.CancelToken;\n    let removePending = (ever) => {\n        for(let p in pending){\n            if(pending[p].u === ever.url + '&'+ ever.method) { //\u5f53\u5f53\u524d\u8bf7\u6c42\u5728\u6570\u7ec4\u4e2d\u5b58\u5728\u65f6\u6267\u884c\u51fd\u6570\u4f53\n                pending[p].f(); //\u6267\u884c\u53d6\u6d88\u64cd\u4f5c\n                pending.splice(p, 1); //\u628a\u8fd9\u6761\u8bb0\u5f55\u4ece\u6570\u7ec4\u4e2d\u79fb\u9664\n            }\n        }\n    }\n\n    //http request \u62e6\u622a\u5668\n    axios.interceptors.request.use(\n    config => {\n      config.data = JSON.stringify(config.data);\n      config.headers = {\n        'Content-Type':'application/x-www-form-urlencoded'\n      }\n      // ------------------------------------------------------------------------------------\n      removePending(config); //\u5728\u4e00\u4e2aajax\u53d1\u9001\u524d\u6267\u884c\u4e00\u4e0b\u53d6\u6d88\u64cd\u4f5c\n      config.cancelToken = new cancelToken((c)=>{\n         // \u8fd9\u91cc\u7684ajax\u6807\u8bc6\u6211\u662f\u7528\u8bf7\u6c42\u5730\u5740&\u8bf7\u6c42\u65b9\u5f0f\u62fc\u63a5\u7684\u5b57\u7b26\u4e32\uff0c\u5f53\u7136\u4f60\u53ef\u4ee5\u9009\u62e9\u5176\u4ed6\u7684\u4e00\u4e9b\u65b9\u5f0f\n         pending.push({ u: config.url + '&'+ config.method, f: c });\n      });\n      // -----------------------------------------------------------------------------------------\n      return config;\n    },\n    error => {\n      return Promise.reject(err);\n    }\n  );\n  //http response \u62e6\u622a\u5668\n  axios.interceptors.response.use(\n    response => {\n      // ------------------------------------------------------------------------------------------\n      removePending(response.config);  //\u5728\u4e00\u4e2aajax\u54cd\u5e94\u540e\u518d\u6267\u884c\u4e00\u4e0b\u53d6\u6d88\u64cd\u4f5c\uff0c\u628a\u5df2\u7ecf\u5b8c\u6210\u7684\u8bf7\u6c42\u4ecepending\u4e2d\u79fb\u9664\n      // -------------------------------------------------------------------------------------------\n      if(response.data.errCode ==2){\n        router.push({\n          path:\"/login\",\n          querry:{redirect:router.currentRoute.fullPath}//\u4ece\u54ea\u4e2a\u9875\u9762\u8df3\u8f6c\n        })\n      }\n      return response;\n    },\n    error => {\n      return Promise.reject(error)\n    }\n  )\n")))}u.isMDXComponent=!0}}]);